"use client";

import React, { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Heart } from "lucide-react";

export default function WillYouMarryIsma() {
  const [noPosition, setNoPosition] = useState({ top: 0, left: 0 });
  const [yesClicked, setYesClicked] = useState(false);
  const [confetti, setConfetti] = useState([]);

  // Generate confetti safely (avoid window error)
  useEffect(() => {
    if (yesClicked) {
      const pieces = Array.from({ length: 40 }).map(() => ({
        left: Math.random() * 100,
        duration: 3 + Math.random() * 2,
        delay: Math.random() * 2,
      }));
      setConfetti(pieces);
    }
  }, [yesClicked]);

  // Romantic background music (safe autoplay after click)
  useEffect(() => {
    const audio = new Audio(
      "https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=romantic-love-11786.mp3"
    );
    audio.loop = true;
    audio.volume = 0.4;

    const enableAudio = () => {
      audio.play().catch(() => {});
      window.removeEventListener("click", enableAudio);
    };

    window.addEventListener("click", enableAudio);

    return () => {
      audio.pause();
      window.removeEventListener("click", enableAudio);
    };
  }, []);

  const moveNoButton = () => {
    const randomTop = Math.floor(Math.random() * 300) - 150;
    const randomLeft = Math.floor(Math.random() * 300) - 150;
    setNoPosition({ top: randomTop, left: randomLeft });
  };

  if (yesClicked) {
    return (
      <div
        className="min-h-screen flex items-center justify-center p-6 relative overflow-hidden"
        style={{
          backgroundImage:
            "url('https://images.unsplash.com/photo-1518199266791-5375a83190b7')",
          backgroundSize: "cover",
          backgroundPosition: "center",
        }}
      >
        {/* Confetti */}
        {confetti.map((piece, i) => (
          <motion.div
            key={i}
            initial={{ y: -100 }}
            animate={{ y: "110vh" }}
            transition={{
              duration: piece.duration,
              repeat: Infinity,
              delay: piece.delay,
            }}
            className="absolute w-3 h-3 bg-pink-400 rounded-full"
            style={{ left: `${piece.left}%` }}
          />
        ))}

        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          transition={{ type: "spring", stiffness: 120 }}
        >
          <Card className="rounded-2xl shadow-2xl bg-white/90 backdrop-blur-md">
            <CardContent className="p-12 text-center space-y-6">
              <motion.div
                animate={{ scale: [1, 1.2, 1] }}
                transition={{ repeat: Infinity, duration: 1.5 }}
              >
                <Heart className="w-20 h-20 mx-auto text-pink-500" />
              </motion.div>
              <h1 className="text-5xl font-extrabold text-pink-600">
                ISMA SAID YES ğŸ’âœ¨
              </h1>
              <p className="text-xl text-gray-700">
                This is the start of our forever, Isma â¤ï¸
              </p>
            </CardContent>
          </Card>
        </motion.div>
      </div>
    );
  }

  return (
    <div
      className="min-h-screen flex items-center justify-center p-6 overflow-hidden"
      style={{
        backgroundImage:
          "url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e')",
        backgroundSize: "cover",
        backgroundPosition: "center",
      }}
    >
      <motion.div
        initial={{ opacity: 0, y: 40 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 1 }}
        className="text-center bg-white/70 backdrop-blur-md p-12 rounded-3xl shadow-2xl"
      >
        <motion.div
          animate={{ y: [0, -15, 0] }}
          transition={{ repeat: Infinity, duration: 2 }}
        >
          <Heart className="w-16 h-16 mx-auto mb-6 text-pink-500" />
        </motion.div>

        <h1 className="text-6xl font-extrabold text-pink-600 mb-6">
          Isma, Will You Marry Me? ğŸ’–
        </h1>
        <p className="text-xl text-gray-700 mb-10">
          You are my today, my tomorrow, and my forever.
        </p>

        <div className="relative flex items-center justify-center gap-10 h-40">
          <Button
            onClick={() => setYesClicked(true)}
            className="text-xl px-10 py-7 rounded-2xl shadow-xl bg-pink-500 hover:bg-pink-600 text-white"
          >
            YES ğŸ’
          </Button>

          <motion.div
            animate={{ x: noPosition.left, y: noPosition.top }}
            transition={{ type: "spring", stiffness: 300 }}
          >
            <Button
              onMouseEnter={moveNoButton}
              className="text-xl px-10 py-7 rounded-2xl shadow-xl bg-gray-400 hover:bg-gray-500 text-white"
            >
              NO ğŸ˜œ
            </Button>
          </motion.div>
        </div>
      </motion.div>
    </div>
  );
}
